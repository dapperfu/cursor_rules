---
description: Rust dependency management requirements with minor version pinning and workspace patterns
globs: ["Cargo.toml", "**/Cargo.toml"]
alwaysApply: false
---

# Rust Dependencies

## Requirement

All Rust projects SHALL use minor version pinning for dependencies (e.g., `1.2.x`) and SHALL properly manage dependencies in Cargo workspaces.

Projects SHALL regularly audit dependencies for security vulnerabilities.

## Rationale

Proper dependency management:
- Ensures reproducible builds
- Prevents breaking changes from major version updates
- Maintains compatibility across the project
- Enables security auditing
- Supports workspace-based dependency sharing

Minor version pinning (e.g., `1.2.x`) allows:
- Bug fixes and security patches
- Prevents breaking changes from minor version updates
- Maintains API compatibility

## Implementation

### Version Pinning

Dependencies SHALL use minor version pinning:

```toml
[dependencies]
serde = "1.0"        # Accepts 1.0.x versions
tokio = "1.35"      # Accepts 1.35.x versions
anyhow = "1.0"      # Accepts 1.0.x versions
```

This is equivalent to using caret requirements (`^1.0`) which is the default in Cargo.

For more restrictive pinning when necessary:

```toml
[dependencies]
critical_lib = "=1.2.3"  # Exact version (use sparingly)
```

### Workspace Dependency Management

Cargo workspaces SHALL use workspace dependency inheritance:

```toml
# Workspace root Cargo.toml
[workspace]
members = ["crate1", "crate2"]

[workspace.dependencies]
serde = "1.0"
tokio = { version = "1.35", features = ["full"] }
anyhow = "1.0"

# Crate Cargo.toml
[package]
name = "crate1"
version = "0.1.0"

[dependencies]
serde = { workspace = true }
tokio = { workspace = true }
anyhow = { workspace = true }
```

Workspace dependencies SHALL:
- Be defined in the workspace root `Cargo.toml`
- Use `workspace = true` in member crates
- Allow consistent version management across the workspace

### Dependency Auditing

Projects SHALL regularly audit dependencies for security vulnerabilities:

```bash
# Install cargo-audit
cargo install cargo-audit

# Run audit
cargo audit
```

Projects SHOULD:
- Run `cargo audit` regularly (e.g., in CI/CD)
- Update dependencies when vulnerabilities are found
- Monitor dependency updates for security patches

### Optional Dependencies

Optional dependencies SHALL be properly configured with features:

```toml
[dependencies]
serde = { version = "1.0", optional = true, features = ["derive"] }

[features]
default = []
serde = ["dep:serde"]  # Use dep: prefix for optional dependencies
```

The `dep:` prefix explicitly marks a dependency as optional and tied to a feature.

### Development Dependencies

Development dependencies SHALL be placed in `[dev-dependencies]`:

```toml
[dev-dependencies]
tokio-test = "0.4"
mockito = "1.0"
```

Development dependencies are only used for tests and examples, not in the final build.

### Build Dependencies

Build dependencies SHALL be placed in `[build-dependencies]`:

```toml
[build-dependencies]
cc = "1.0"
```

Build dependencies are used during the build process (e.g., in `build.rs`).

## Exceptions

This requirement does NOT apply to:
- Dependencies that require exact versions for compatibility reasons (with justification)
- Dependencies that are part of the Rust toolchain
- Workspace-only configuration files
